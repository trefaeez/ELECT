<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>عرض تفاعلي للشبكة الكهربائية (GoJS)</title>
    
    <!-- تضمين مكتبة Bootstrap للتنسيق -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- تضمين Bootstrap RTL للدعم العربي -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
    <!-- تضمين Font Awesome للأيقونات -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- تضمين html2canvas لتصدير المخطط كصورة -->
    <script src="/static/js/libs/html2canvas.min.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', 'Tahoma', 'Arial', sans-serif;
            background-color: #f8f9fa;
        }
        
        .network-container {
            width: 100%;
            height: 80vh;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            position: relative;
        }
        
        .controls-container {
            padding: 10px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .details-panel {
            padding: 15px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            min-height: 200px;
        }
        
        .network-legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            margin-left: 8px;
        }
        
        .node-details-table td {
            padding: 5px 10px;
        }
        
        .node-details-table td:first-child {
            font-weight: bold;
            width: 40%;
        }
        
        .custom-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            display: flex;
            gap: 5px;
        }
        
        .loading-indicator {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: #0d6efd;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .comparison-alert {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- شريط التنقل العلوي -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-bolt"></i> عرض تفاعلي للشبكة الكهربائية (GoJS)
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            <i class="fas fa-home"></i> الرئيسية
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/network-visualizer/">
                            <i class="fas fa-project-diagram"></i> المخطط التفاعلي (ReactFlow)
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#">
                            <i class="fas fa-project-diagram"></i> المخطط التفاعلي (GoJS)
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row mb-3">
            <div class="col-12">
                <div class="controls-container">
                    <div class="d-flex justify-content-between align-items-center">
                        <h2 class="mb-0">
                            <i class="fas fa-project-diagram text-primary"></i> 
                            مخطط الشبكة الكهربائية التفاعلي (GoJS)
                        </h2>
                        <div>
                            <button id="btnExportImage" class="btn btn-success">
                                <i class="fas fa-file-image"></i> تصدير كصورة
                            </button>
                            <button id="btnResetView" class="btn btn-secondary ms-2">
                                <i class="fas fa-sync-alt"></i> إعادة ضبط العرض
                            </button>
                            <a href="/network-visualizer/" class="btn btn-info ms-2">
                                <i class="fas fa-exchange-alt"></i> المخطط التقليدي
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- تنبيه المقارنة -->
        <div class="row">
            <div class="col-12">
                <div class="alert alert-info comparison-alert" role="alert">
                    <i class="fas fa-info-circle"></i>
                    <strong>ميزات مكتبة GoJS:</strong> تجنب تقاطع الخطوط مع العناصر، تخطيط متقدم للشبكة، أداء أفضل، والمزيد من الميزات التفاعلية.
                    <a href="/network-visualizer/" class="alert-link">قارن بالمخطط التقليدي</a> لمعرفة الفرق.
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-lg-9">
                <!-- حاوية مخطط الشبكة -->
                <div id="networkContainer" class="network-container">
                    <!-- سيتم إضافة مخطط GoJS هنا -->
                    
                    <!-- مؤشر التحميل -->
                    <div id="loadingIndicator" class="loading-indicator">
                        <div class="spinner"></div>
                    </div>
                    
                    <!-- مفتاح الألوان -->
                    <div class="network-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #dc3545;"></div>
                            <span>مصادر الطاقة</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #198754;"></div>
                            <span>اللوحات الكهربائية</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ffc107;"></div>
                            <span>القواطع الكهربائية</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #0d6efd;"></div>
                            <span>الأحمال الكهربائية</span>
                        </div>
                        <div class="legend-item mt-2">
                            <div class="legend-color" style="background-color: #ff6600;"></div>
                            <span>مسار التغذية التصاعدي</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #00aaff;"></div>
                            <span>مسار التغذية التنازلي</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3">
                <!-- لوحة تفاصيل العنصر المحدد -->
                <div id="detailsPanel" class="details-panel">
                    <h4 id="detailsTitle">تفاصيل العنصر المحدد</h4>
                    <hr>
                    <div id="detailsContent">
                        <p class="text-muted">انقر على أي عنصر في المخطط لعرض تفاصيله هنا.</p>
                    </div>
                </div>
                
                <!-- فلاتر العرض -->
                <div class="details-panel mt-3">
                    <h4><i class="fas fa-filter"></i> فلاتر العرض</h4>
                    <hr>
                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="showPowerSources" checked>
                        <label class="form-check-label" for="showPowerSources">عرض مصادر الطاقة</label>
                    </div>
                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="showPanels" checked>
                        <label class="form-check-label" for="showPanels">عرض اللوحات الكهربائية</label>
                    </div>
                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="showBreakers" checked>
                        <label class="form-check-label" for="showBreakers">عرض القواطع الكهربائية</label>
                    </div>
                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="showLoads" checked>
                        <label class="form-check-label" for="showLoads">عرض الأحمال الكهربائية</label>
                    </div>
                </div>
                
                <!-- مسارات التغذية -->
                <div id="pathPanel" class="details-panel mt-3" style="display: none;">
                    <h4><i class="fas fa-route"></i> مسار التغذية</h4>
                    <hr>
                    <div id="pathContent">
                        <!-- سيتم إضافة محتوى المسار هنا -->
                    </div>
                </div>
                
                <!-- مميزات المكتبة الجديدة -->
                <div class="details-panel mt-3">
                    <h4><i class="fas fa-star"></i> ميزات GoJS</h4>
                    <hr>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check-circle text-success me-2"></i> تجنب تقاطع الخطوط مع العناصر</li>
                        <li><i class="fas fa-check-circle text-success me-2"></i> إخفاء/إظهار القواطع عند النقر على اللوحة</li>
                        <li><i class="fas fa-check-circle text-success me-2"></i> إضاءة مسارات التغذية الصاعدة والهابطة</li>
                        <li><i class="fas fa-check-circle text-success me-2"></i> تكبير/تصغير أفضل للعناصر</li>
                        <li><i class="fas fa-check-circle text-success me-2"></i> توزيع أوتوماتيكي متقدم للعناصر</li>
                    </ul>
                    
                    <div class="mt-3">
                        <button id="btnCompareLibraries" class="btn btn-outline-primary w-100">
                            <i class="fas fa-balance-scale"></i> تقييم مكتبات العرض
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- نافذة المقارنة بين المكتبات -->
    <div class="modal fade" id="comparisonModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">مقارنة بين مكتبات العرض التفاعلي</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>الميزة</th>
                                <th>ReactFlow</th>
                                <th>GoJS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>تجنب تقاطع الروابط مع العناصر</td>
                                <td><span class="text-danger"><i class="fas fa-times-circle"></i> لا</span></td>
                                <td><span class="text-success"><i class="fas fa-check-circle"></i> نعم</span></td>
                            </tr>
                            <tr>
                                <td>أداء مع الشبكات الكبيرة</td>
                                <td>متوسط</td>
                                <td>ممتاز</td>
                            </tr>
                            <tr>
                                <td>إمكانية التخصيص</td>
                                <td>جيد</td>
                                <td>ممتاز</td>
                            </tr>
                            <tr>
                                <td>سهولة الاستخدام</td>
                                <td>سهل</td>
                                <td>متوسط الصعوبة</td>
                            </tr>
                            <tr>
                                <td>توجيه الروابط الذكي</td>
                                <td>محدود</td>
                                <td>متقدم</td>
                            </tr>
                            <tr>
                                <td>دعم اللغة العربية</td>
                                <td>جيد</td>
                                <td>ممتاز</td>
                            </tr>
                            <tr>
                                <td>إمكانية التصدير</td>
                                <td>محدود</td>
                                <td>متقدم</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="mt-3">
                        <h6>الخلاصة:</h6>
                        <p>
                            مكتبة <strong>GoJS</strong> تقدم أداءً أفضل وقدرات متقدمة في توجيه الروابط لتجنب تقاطعها مع العناصر،
                            وهي مناسبة أكثر للمخططات المعقدة. بينما تتميز <strong>ReactFlow</strong> بسهولة الاستخدام
                            وتكامل أفضل مع تطبيقات React.
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- تذييل الصفحة -->
    <footer class="text-center text-muted mt-5 py-3">
        <div class="container">
            <p>نظام إدارة شبكة الطاقة الكهربائية &copy; 2025</p>
        </div>
    </footer>

    <!-- تضمين Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- سكريبت واجهة برمجة التطبيقات -->
    <script>
        // وظائف مساعدة للتعامل مع واجهة برمجة التطبيقات
        const API_BASE_URL = '/api';
        
        /**
         * وظيفة مساعدة لإرسال طلبات للواجهة البرمجية
         * @param {string} url - مسار نقطة النهاية
         * @param {string} method - طريقة الطلب (GET, POST, PUT, DELETE)
         * @param {Object} data - البيانات المرسلة (اختياري)
         * @returns {Promise} وعد بالاستجابة
         */
        async function apiRequest(url, method = 'GET', data = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                // إذا كان هناك بيانات، أضفها إلى الطلب
                if (data && (method === 'POST' || method === 'PUT' || method === 'PATCH')) {
                    options.body = JSON.stringify(data);
                }
                
                // إرسال الطلب
                const response = await fetch(url, options);
                
                // التحقق من نجاح الطلب
                if (response.ok) {
                    // إذا كانت الاستجابة فارغة، إرجاع نجاح بدون بيانات
                    if (response.status === 204) {
                        return { success: true };
                    }
                    
                    // محاولة تحليل البيانات كـ JSON
                    const responseData = await response.json();
                    return { success: true, data: responseData };
                } else {
                    // محاولة استخراج رسالة الخطأ من الاستجابة
                    let errorMessage = 'حدث خطأ غير معروف';
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.message || errorData.detail || JSON.stringify(errorData);
                    } catch (e) {
                        errorMessage = `خطأ ${response.status}: ${response.statusText}`;
                    }
                    
                    return { 
                        success: false, 
                        error: { 
                            status: response.status, 
                            message: errorMessage 
                        } 
                    };
                }
            } catch (error) {
                console.error('خطأ في طلب API:', error);
                return { 
                    success: false, 
                    error: { 
                        message: 'فشل الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت.' 
                    } 
                };
            }
        }
        
        // واجهات برمجة تطبيقات للحصول على بيانات الشبكة
        const NetworkAPI = {
            getPowerSources: async function() {
                return await apiRequest(`${API_BASE_URL}/powersources/`);
            },
            
            getPanels: async function() {
                return await apiRequest(`${API_BASE_URL}/panels/`);
            },
            
            getCircuitBreakers: async function() {
                return await apiRequest(`${API_BASE_URL}/circuitbreakers/`);
            },
            
            getLoads: async function() {
                return await apiRequest(`${API_BASE_URL}/loads/`);
            },
            
            getPowerSourceById: async function(id) {
                return await apiRequest(`${API_BASE_URL}/powersources/${id}/`);
            },
            
            getPanelById: async function(id) {
                return await apiRequest(`${API_BASE_URL}/panels/${id}/`);
            },
            
            getCircuitBreakerById: async function(id) {
                return await apiRequest(`${API_BASE_URL}/circuitbreakers/${id}/`);
            },
            
            getLoadById: async function(id) {
                return await apiRequest(`${API_BASE_URL}/loads/${id}/`);
            }
        };
    </script>
    
    <!-- تضمين مكون مصور الشبكة باستخدام GoJS -->
    <script type="module">
        import { GoJSNetworkVisualizer } from '/static/js/modules/gojs_visualizer.js';
        
        // قواميس للترجمة
        const typeNames = {
            'powerSource': 'مصدر طاقة',
            'panel': 'لوحة كهربائية',
            'circuitBreaker': 'قاطع كهربائي',
            'load': 'حمل كهربائي',
            'main': 'رئيسية',
            'sub_main': 'رئيسية فرعية',
            'sub': 'فرعية',
            'distribution': 'توزيع',
            'main_circuit_breaker': 'قاطع رئيسي',
            'copper': 'نحاس',
            'aluminum': 'ألمنيوم'
        };
        
        // إنشاء كائن المخطط عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', () => {
            // إنشاء المصور
            const networkVisualizer = new GoJSNetworkVisualizer('networkContainer');
            
            // إخفاء مؤشر التحميل الافتراضي
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (loadingIndicator) {
                loadingIndicator.style.display = 'none';
            }
            
            // ربط وظيفة تصدير الصورة
            document.getElementById('btnExportImage').addEventListener('click', async () => {
                try {
                    const imgData = await networkVisualizer.exportAsImage();
                    if (imgData) {
                        // إنشاء رابط لتنزيل الصورة
                        const link = document.createElement('a');
                        link.download = 'network-diagram.png';
                        link.href = imgData;
                        link.click();
                    }
                } catch (error) {
                    console.error('خطأ في تصدير الصورة:', error);
                    alert('حدث خطأ أثناء تصدير الصورة');
                }
            });
            
            // ربط زر إعادة ضبط العرض
            document.getElementById('btnResetView').addEventListener('click', () => {
                if (networkVisualizer.diagram) {
                    networkVisualizer.diagram.commandHandler.zoomToFit();
                }
            });
            
            // ربط زر المقارنة
            document.getElementById('btnCompareLibraries').addEventListener('click', () => {
                const comparisonModal = new bootstrap.Modal(document.getElementById('comparisonModal'));
                comparisonModal.show();
            });
            
            // ربط فلاتر العرض
            document.getElementById('showPowerSources').addEventListener('change', () => {
                networkVisualizer.updateDiagram();
            });
            
            document.getElementById('showPanels').addEventListener('change', () => {
                networkVisualizer.updateDiagram();
            });
            
            document.getElementById('showBreakers').addEventListener('change', () => {
                networkVisualizer.updateDiagram();
            });
            
            document.getElementById('showLoads').addEventListener('change', () => {
                networkVisualizer.updateDiagram();
            });
            
            // تعيين معالج لعرض تفاصيل العنصر المحدد
            networkVisualizer.onNodeSelect((nodeInfo) => {
                // عرض تفاصيل العنصر المحدد
                displayNodeDetails(nodeInfo);
            });
            
            // تهيئة المخطط وتحميل البيانات
            networkVisualizer.visualize().then(success => {
                if (!success) {
                    alert('فشل في تحميل بيانات الشبكة. يرجى تحديث الصفحة والمحاولة مرة أخرى.');
                }
            });
        });
        
        /**
         * عرض تفاصيل العنصر المحدد في اللوحة الجانبية
         * @param {Object} nodeInfo - معلومات العنصر المحدد
         */
        function displayNodeDetails(nodeInfo) {
            const detailsPanel = document.getElementById('detailsPanel');
            const detailsTitle = document.getElementById('detailsTitle');
            const detailsContent = document.getElementById('detailsContent');
            const pathPanel = document.getElementById('pathPanel');
            const pathContent = document.getElementById('pathContent');
            
            // تفاصيل العنصر المحدد
            const nodeType = nodeInfo.type;
            const nodeData = nodeInfo.data;
            
            // تعيين العنوان
            detailsTitle.innerHTML = `<i class="fas fa-info-circle"></i> تفاصيل ${typeNames[nodeType] || nodeType}`;
            
            // إنشاء جدول التفاصيل
            let detailsHtml = '<table class="node-details-table w-100">';
            
            // إضافة التفاصيل حسب نوع العنصر
            switch (nodeType) {
                case 'powerSource':
                    detailsHtml += `
                        <tr><td>الاسم:</td><td>${nodeData.name}</td></tr>
                        <tr><td>الجهد:</td><td>${nodeData.voltage} فولت</td></tr>
                        <tr><td>الأمبير:</td><td>${nodeData.ampacity} أمبير</td></tr>
                        <tr><td>الوصف:</td><td>${nodeData.description || '-'}</td></tr>
                    `;
                    break;
                case 'panel':
                    detailsHtml += `
                        <tr><td>الاسم:</td><td>${nodeData.name}</td></tr>
                        <tr><td>النوع:</td><td>${typeNames[nodeData.panel_type] || nodeData.panel_type}</td></tr>
                        <tr><td>الجهد:</td><td>${nodeData.voltage} فولت</td></tr>
                        <tr><td>الأمبير:</td><td>${nodeData.ampacity} أمبير</td></tr>
                        <tr><td>الموقع:</td><td>${nodeData.location || '-'}</td></tr>
                    `;
                    break;
                case 'circuitBreaker':
                    detailsHtml += `
                        <tr><td>الاسم:</td><td>${nodeData.name || `قاطع ${nodeData.id}`}</td></tr>
                        <tr><td>الأمبير المقنن:</td><td>${nodeData.rated_current} أمبير</td></tr>
                        <tr><td>عدد الأقطاب:</td><td>${nodeData.poles}</td></tr>
                        <tr><td>الدور:</td><td>${typeNames[nodeData.role] || nodeData.role}</td></tr>
                    `;
                    break;
                case 'load':
                    detailsHtml += `
                        <tr><td>الاسم:</td><td>${nodeData.name}</td></tr>
                        <tr><td>النوع:</td><td>${nodeData.load_type}</td></tr>
                        <tr><td>الأمبير:</td><td>${nodeData.ampacity} أمبير</td></tr>
                        <tr><td>معامل القدرة:</td><td>${nodeData.power_factor}</td></tr>
                        <tr><td>الموقع:</td><td>${nodeData.location || '-'}</td></tr>
                    `;
                    break;
            }
            
            detailsHtml += `</table>
                <div class="mt-3">
                    <a href="/view/${nodeType}/${nodeData.id}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-external-link-alt"></i> عرض كامل
                    </a>
                    <a href="/edit/${nodeType}/${nodeData.id}" class="btn btn-sm btn-outline-secondary ms-2">
                        <i class="fas fa-edit"></i> تحرير
                    </a>
                </div>
            `;
            
            // عرض التفاصيل
            detailsContent.innerHTML = detailsHtml;
            
            // عرض معلومات المسار إذا كانت متاحة
            if (nodeInfo.pathData) {
                displayPathData(nodeInfo.pathData);
                pathPanel.style.display = 'block';
            } else {
                pathPanel.style.display = 'none';
            }
        }
        
        /**
         * عرض بيانات المسار في اللوحة الجانبية
         * @param {Object} pathData - بيانات المسار
         */
        function displayPathData(pathData) {
            const pathContent = document.getElementById('pathContent');
            let pathHtml = '';
            
            // إضافة مصادر الطاقة
            if (pathData.powerSources && pathData.powerSources.length > 0) {
                pathHtml += `<h5>مصادر الطاقة</h5>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>الاسم</th>
                            <th>الجهد</th>
                            <th>الأمبير</th>
                        </tr>
                    </thead>
                    <tbody>`;
                
                pathData.powerSources.forEach(source => {
                    pathHtml += `
                        <tr>
                            <td>${source.name}</td>
                            <td>${source.data.voltage} V</td>
                            <td>${source.data.ampacity} A</td>
                        </tr>
                    `;
                });
                
                pathHtml += `</tbody></table>`;
            }
            
            // إضافة اللوحات
            if (pathData.panels && pathData.panels.length > 0) {
                pathHtml += `<h5>اللوحات</h5>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>الاسم</th>
                            <th>النوع</th>
                            <th>الأمبير</th>
                        </tr>
                    </thead>
                    <tbody>`;
                
                pathData.panels.forEach(panel => {
                    pathHtml += `
                        <tr>
                            <td>${panel.name}</td>
                            <td>${typeNames[panel.data.panel_type] || panel.data.panel_type}</td>
                            <td>${panel.data.ampacity} A</td>
                        </tr>
                    `;
                });
                
                pathHtml += `</tbody></table>`;
            }
            
            // إضافة القواطع
            if (pathData.breakers && pathData.breakers.length > 0) {
                pathHtml += `<h5>القواطع</h5>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>الاسم</th>
                            <th>الأمبير</th>
                            <th>الأقطاب</th>
                        </tr>
                    </thead>
                    <tbody>`;
                
                pathData.breakers.forEach(breaker => {
                    pathHtml += `
                        <tr>
                            <td>${breaker.name || `قاطع ${breaker.data.id}`}</td>
                            <td>${breaker.data.rated_current} A</td>
                            <td>${breaker.data.poles}</td>
                        </tr>
                    `;
                });
                
                pathHtml += `</tbody></table>`;
            }
            
            // إضافة الأحمال
            if (pathData.loads && pathData.loads.length > 0) {
                pathHtml += `<h5>الأحمال</h5>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>الاسم</th>
                            <th>النوع</th>
                            <th>الأمبير</th>
                        </tr>
                    </thead>
                    <tbody>`;
                
                pathData.loads.forEach(load => {
                    pathHtml += `
                        <tr>
                            <td>${load.name}</td>
                            <td>${load.data.load_type}</td>
                            <td>${load.data.ampacity} A</td>
                        </tr>
                    `;
                });
                
                pathHtml += `</tbody></table>`;
            }
            
            // إذا لم تكن هناك بيانات للمسار
            if (pathHtml === '') {
                pathHtml = '<p class="text-muted">لم يتم العثور على بيانات المسار</p>';
            }
            
            pathContent.innerHTML = pathHtml;
        }
    </script>
</body>
</html>